<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- ============================================= -->
        <!-- CATEGORÍA PARA GRUPOS DE SUPERVISIÓN -->
        <!-- ============================================= -->
        
        <record id="supervision_category" model="ir.module.category">
            <field name="name">Supervisión Horas Extras</field>
            <field name="description">Grupos para supervisión de horas extras por departamento</field>
            <field name="sequence">15</field>
        </record>

        <!-- ============================================= -->
        <!-- GRUPOS DE JEFES -->
        <!-- ============================================= -->
        
        <record id="group_jefes_ti" model="res.groups">
            <field name="name">Jefes TI - Horas Extras</field>
            <field name="category_id" ref="supervision_category"/>
            <field name="comment">Pueden aprobar horas extras del departamento de TI</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="group_jefes_operaciones" model="res.groups">
            <field name="name">Jefes Operaciones - Horas Extras</field>
            <field name="category_id" ref="supervision_category"/>
            <field name="comment">Pueden aprobar horas extras del departamento de Operaciones</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="group_jefes_digito" model="res.groups">
            <field name="name">Jefes Digito - Horas Extras</field>
            <field name="category_id" ref="supervision_category"/>
            <field name="comment">Pueden aprobar horas extras del departamento de Digito</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- ============================================= -->
        <!-- GRUPOS DE SUPERVISORES -->
        <!-- ============================================= -->

        <record id="group_supervisores_ti" model="res.groups">
            <field name="name">Supervisores TI - Horas Extras</field>
            <field name="category_id" ref="supervision_category"/>
            <field name="comment">Pueden aprobar horas extras de sus subordinados directos en TI</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="group_supervisores_operaciones_cnb" model="res.groups">
            <field name="name">Supervisores Operaciones/CNB - Horas Extras</field>
            <field name="category_id" ref="supervision_category"/>
            <field name="comment">Pueden aprobar horas extras de sus subordinados directos en Operaciones</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- ============================================= -->
        <!-- REGLAS DE ACCESO PARA JEFES -->
        <!-- ============================================= -->

        <!-- Jefes TI - Ven TODO el departamento TI -->
        <record id="rule_jefes_ti" model="ir.rule">
            <field name="name">Jefes TI - Acceso Departamento</field>
            <field name="model_id" ref="model_hr_overtime"/>
            <field name="groups" eval="[(4, ref('group_jefes_ti'))]"/>
            <field name="domain_force">[('employee_id.department_id.name', 'ilike', 'TI')]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Jefes Operaciones - Ven TODO el departamento Operaciones -->
        <record id="rule_jefes_operaciones" model="ir.rule">
            <field name="name">Jefes Operaciones - Acceso Departamento</field>
            <field name="model_id" ref="model_hr_overtime"/>
            <field name="groups" eval="[(4, ref('group_jefes_operaciones'))]"/>
            <field name="domain_force">[('employee_id.department_id.name', 'ilike', 'Operaciones')]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Jefes Digito - Ven TODO el departamento Digito -->
        <record id="rule_jefes_digito" model="ir.rule">
            <field name="name">Jefes Digito - Acceso Departamento</field>
            <field name="model_id" ref="model_hr_overtime"/>
            <field name="groups" eval="[(4, ref('group_jefes_digito'))]"/>
            <field name="domain_force">[('employee_id.department_id.name', 'ilike', 'Digito')]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ============================================= -->
        <!-- REGLAS DE ACCESO PARA SUPERVISORES -->
        <!-- ============================================= -->

        <!-- Supervisores TI - Ven solo subordinados directos -->
        <record id="rule_supervisores_ti" model="ir.rule">
            <field name="name">Supervisores TI - Subordinados Directos</field>
            <field name="model_id" ref="model_hr_overtime"/>
            <field name="groups" eval="[(4, ref('group_supervisores_ti'))]"/>
            <field name="domain_force">[('employee_id.parent_id.user_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Supervisores Operaciones - Ven solo subordinados directos -->
        <record id="rule_supervisores_operaciones" model="ir.rule">
            <field name="name">Supervisores Operaciones - Subordinados Directos</field>
            <field name="model_id" ref="model_hr_overtime"/>
            <field name="groups" eval="[(4, ref('group_supervisores_operaciones_cnb'))]"/>
            <field name="domain_force">[('employee_id.parent_id.user_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ============================================= -->
        <!-- MANTENER REGLA ORIGINAL PARA EMPLEADOS BÁSICOS -->
        <!-- ============================================= -->

        <!-- Empleados básicos - Solo ven sus propias solicitudes -->
        <record id="hr_overtime_employee_rule" model="ir.rule">
            <field name="name">Employee Overtime Access</field>
            <field name="model_id" ref="model_hr_overtime"/>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="domain_force">[('employee_id.user_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Responsables RRHH2 ven todas las solicitudes -->
        <record id="hr_overtime_rrhh_rule" model="ir.rule">
            <field name="name">RRHH Overtime Full Access</field>
            <field name="model_id" ref="model_hr_overtime"/>
            <field name="groups" eval="[(4, ref('hr_documenta.rrhh_responsable2'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

    </data>
</odoo>